/*!
 * jQCloud 2.0.4
 * Copyright 2011 Luca Ongaro (http://www.lucaongaro.eu)
 * Copyright 2013 Daniel White (http://www.developerdan.com)
 * Copyright 2014-2017 Damien "Mistic" Sorel (http://www.strangeplanet.fr)
 * Licensed under MIT (http://opensource.org/licenses/MIT)
 */
(function(e,n){typeof define==="function"&&define.amd?define(["jquery"],n):typeof module==="object"&&module.exports?module.exports=n(require("jquery")):n(e.jQuery)})(this,function(e){function n(b,a,d){var g=null,h=0;return function(){function k(){h=(new Date).getTime();return b.apply(d||l,Array.prototype.slice.call(f))}var c=(new Date).getTime()-h,f=arguments,l=this;if(c>a)return k();clearTimeout(g);g=setTimeout(k,a-c)}}var m=function(b,a,d){this.$element=e(b);this.word_array=a||[];this.options=d;
this.colorGenerator=this.sizeGenerator=null;this.data={placed_words:[],timeouts:{},namespace:null,step:null,angle:null,aspect_ratio:null,max_weight:null,min_weight:null,sizes:[],colors:[]};this.initialize()};m.DEFAULTS={width:100,height:100,center:{x:.5,y:.5},steps:10,delay:null,shape:"elliptic",classPattern:"w{n}",encodeURI:!0,removeOverflowing:!0,afterCloudRender:null,autoResize:!1,colors:null,fontSize:null,template:null};m.prototype={initialize:function(){this.options.width?this.$element.width(this.options.width):
this.options.width=this.$element.width();this.options.height?this.$element.height(this.options.height):this.options.height=this.$element.height();this.options=e.extend(!0,{},m.DEFAULTS,this.options);this.options.delay===null&&(this.options.delay=this.word_array.length>50?10:0);this.options.center.x>1&&(this.options.center.x/=this.options.width,this.options.center.y/=this.options.height);if(typeof this.options.colors=="function")this.colorGenerator=this.options.colors;else if(Array.isArray(this.options.colors)){var b=
this.options.colors.length;if(b>0){if(b<this.options.steps)for(var a=b;a<this.options.steps;a++)this.options.colors[a]=this.options.colors[b-1];this.colorGenerator=function(d){return this.options.colors[this.options.steps-d]}}}if(typeof this.options.fontSize=="function")this.sizeGenerator=this.options.fontSize;else if(e.isPlainObject(this.options.fontSize))this.sizeGenerator=function(d,g,h){g=d*this.options.fontSize.to;return Math.round(g+(d*this.options.fontSize.from-g)/(this.options.steps-1)*(h-
1))+"px"};else if(Array.isArray(this.options.fontSize)&&(b=this.options.fontSize.length,b>0)){if(b<this.options.steps)for(a=b;a<this.options.steps;a++)this.options.fontSize[a]=this.options.fontSize[b-1];this.sizeGenerator=function(d,g,h){return this.options.fontSize[this.options.steps-h]}}this.data.angle=Math.random()*6.28;this.data.step=this.options.shape==="rectangular"?18:2;this.data.aspect_ratio=this.options.width/this.options.height;this.clearTimeouts();this.data.namespace=(this.$element.attr("id")||
Math.floor(Math.random()*1E6).toString(36))+"_word_";this.$element.addClass("jqcloud");this.$element.css("position")==="static"&&this.$element.css("position","relative");this.createTimeout(e.proxy(this.drawWordCloud,this),10);if(this.options.autoResize)e(window).on("resize."+this.data.namespace,n(this.resize,50,this))},createTimeout:function(b,a){var d=setTimeout(e.proxy(function(){delete this.data.timeouts[d];b()},this),a);this.data.timeouts[d]=!0},clearTimeouts:function(){e.each(this.data.timeouts,
function(b){clearTimeout(b)});this.data.timeouts={}},overlapping:function(b,a){return Math.abs(2*b.left+b.width-2*a.left-a.width)<b.width+a.width&&Math.abs(2*b.top+b.height-2*a.top-a.height)<b.height+a.height?!0:!1},hitTest:function(b){for(var a=0,d=this.data.placed_words.length;a<d;a++)if(this.overlapping(b,this.data.placed_words[a]))return!0;return!1},drawWordCloud:function(){var b;this.$element.children('[id^="'+this.data.namespace+'"]').remove();if(this.word_array.length!==0){var a=0;for(b=this.word_array.length;a<
b;a++)this.word_array[a].weight=parseFloat(this.word_array[a].weight,10);this.word_array.sort(function(d,g){return g.weight-d.weight});this.data.max_weight=this.word_array[0].weight;this.data.min_weight=this.word_array[this.word_array.length-1].weight;this.data.colors=[];if(this.colorGenerator)for(a=0;a<this.options.steps;a++)this.data.colors.push(this.colorGenerator(a+1));this.data.sizes=[];if(this.sizeGenerator)for(a=0;a<this.options.steps;a++)this.data.sizes.push(this.sizeGenerator(this.options.width,
this.options.height,a+1));if(this.options.delay>0)this.drawOneWordDelayed();else{a=0;for(b=this.word_array.length;a<b;a++)this.drawOneWord(a,this.word_array[a]);typeof this.options.afterCloudRender==="function"&&this.options.afterCloudRender.call(this.$element)}}},drawOneWord:function(b,a){var d=this.data.angle,g=0,h=0,k=0,c=Math.floor(this.options.steps/2);a.attr=e.extend({},a.html,{id:this.data.namespace+b});this.data.max_weight!=this.data.min_weight&&(c=Math.round((a.weight-this.data.min_weight)*
(this.options.steps-1)/(this.data.max_weight-this.data.min_weight))+1);var f=e("<span>").attr(a.attr);f.addClass("jqcloud-word");this.options.classPattern&&f.addClass(this.options.classPattern.replace("{n}",c));this.data.colors.length&&f.css("color",this.data.colors[c-1]);a.color&&f.css("color",a.color);this.data.sizes.length&&f.css("font-size",this.data.sizes[c-1]);this.options.template?f.html(this.options.template(a)):a.link?(typeof a.link==="string"&&(a.link={href:a.link}),this.options.encodeURI&&
(a.link.href=encodeURI(a.link.href).replace(/'/g,"%27")),f.append(e("<a>").attr(a.link).text(a.text))):f.text(a.text);if(a.handlers)f.on(a.handlers);this.$element.append(f);c={width:f.outerWidth(),height:f.outerHeight()};c.left=this.options.center.x*this.options.width-c.width/2;c.top=this.options.center.y*this.options.height-c.height/2;var l=f[0].style;l.position="absolute";l.left=c.left+"px";for(l.top=c.top+"px";this.hitTest(c);){if(this.options.shape==="rectangular")switch(h++,h*this.data.step>
(1+Math.floor(k/2))*this.data.step*(k%4%2===0?1:this.data.aspect_ratio)&&(h=0,k++),k%4){case 1:c.left+=this.data.step*this.data.aspect_ratio+Math.random()*2;break;case 2:c.top-=this.data.step+Math.random()*2;break;case 3:c.left-=this.data.step*this.data.aspect_ratio+Math.random()*2;break;case 0:c.top+=this.data.step+Math.random()*2}else g+=this.data.step,d+=(b%2===0?1:-1)*this.data.step,c.left=this.options.center.x*this.options.width-c.width/2+g*Math.cos(d)*this.data.aspect_ratio,c.top=this.options.center.y*
this.options.height+g*Math.sin(d)-c.height/2;l.left=c.left+"px";l.top=c.top+"px"}this.options.removeOverflowing&&(c.left<0||c.top<0||c.left+c.width>this.options.width||c.top+c.height>this.options.height)?f.remove():(this.data.placed_words.push(c),typeof a.afterWordRender==="function"&&a.afterWordRender.call(f))},drawOneWordDelayed:function(b){b=b||0;this.$element.is(":visible")?b<this.word_array.length?(this.drawOneWord(b,this.word_array[b]),this.createTimeout(e.proxy(function(){this.drawOneWordDelayed(b+
1)},this),this.options.delay)):typeof this.options.afterCloudRender=="function"&&this.options.afterCloudRender.call(this.$element):this.createTimeout(e.proxy(function(){this.drawOneWordDelayed(b)},this),10)},destroy:function(){this.options.autoResize&&e(window).off("resize."+this.data.namespace);this.clearTimeouts();this.$element.removeClass("jqcloud");this.$element.removeData("jqcloud");this.$element.children('[id^="'+this.data.namespace+'"]').remove()},update:function(b){this.word_array=b;this.data.placed_words=
[];this.clearTimeouts();this.drawWordCloud()},resize:function(){var b=this.$element.width(),a=this.$element.height();if(b!=this.options.width||a!=this.options.height)this.options.width=b,this.options.height=a,this.data.aspect_ratio=this.options.width/this.options.height,this.update(this.word_array)}};e.fn.jQCloud=function(b,a){var d=arguments;return this.each(function(){var g=e(this),h=g.data("jqcloud");if(h||b!=="destroy")h?typeof b==="string"&&h[b].apply(h,Array.prototype.slice.call(d,1)):g.data("jqcloud",
new m(this,b,typeof a==="object"?a:{}))})};e.fn.jQCloud.defaults={set:function(b){e.extend(!0,m.DEFAULTS,b)},get:function(b){var a=m.DEFAULTS;b&&(a=a[b]);return e.extend(!0,{},a)}}});
